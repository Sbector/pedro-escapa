---
import Layout from "@layouts/Layout.astro";
import { menu } from "@lib/menu";
import { getSubitemData } from "@lib/getSubitemData";
import { getCollection } from "astro:content";
import Carousel from "@components/Carousel.jsx";
import Wrapper from "@components/Wrapper.astro";

export async function getStaticPaths() {
  const paths = [];

  for (const item of menu) {
    if (item.visible !== false && item.subitems) {
      for (const sub of item.subitems) {
        if (sub.visible !== false) {
          paths.push({
            params: {
              categoria: item.id,
              slug: sub.slug,
            },
          });
        }
      }
    }
  }

  return paths;
}

const { categoria, slug } = Astro.params;
const subitemData = getSubitemData(menu, categoria, slug);

if (!subitemData) {
  throw new Error(`No se encontró el subitem: ${categoria}/${slug}`);
}

const { label, className = "" } = subitemData;

// Construir la ruta actual explícitamente
const currentPath = `/${categoria}/${slug}`;

// Traer la colección de imágenes
const itemCollections = await getCollection("itemCollections");
const collection = itemCollections.find(item => item.id === slug);
---
<Layout title={`${collection?.data.title} · Pedro Escapa`} currentPath={currentPath}>
  <Wrapper className={className}>
    {collection?.data?.images && (
      <Carousel client:load images={collection.data.images} />
    )}
  </Wrapper>
</Layout>
